


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > JsonStringWriter</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.esri.core.geometry</a>
</div>

<h1>Coverage Summary for Class: JsonStringWriter (com.esri.core.geometry)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JsonStringWriter</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85%
  </span>
  <span class="absValue">
    (34/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    82,7%
  </span>
  <span class="absValue">
    (162/196)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; Copyright 1995-2015 Esri
&nbsp;
&nbsp;   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp;   you may not use this file except in compliance with the License.
&nbsp;   You may obtain a copy of the License at
&nbsp;
&nbsp;       http://www.apache.org/licenses/LICENSE-2.0
&nbsp;
&nbsp;   Unless required by applicable law or agreed to in writing, software
&nbsp;   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp;   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp;   See the License for the specific language governing permissions and
&nbsp;   limitations under the License.
&nbsp;
&nbsp; For additional information, contact:
&nbsp; Environmental Systems Research Institute, Inc.
&nbsp; Attn: Contracts Dept
&nbsp; 380 New York Street
&nbsp; Redlands, California, USA 92373
&nbsp;
&nbsp; email: contracts@esri.com
&nbsp; */
&nbsp;package com.esri.core.geometry;
&nbsp;
&nbsp;final class JsonStringWriter extends JsonWriter {
&nbsp;
&nbsp;	@Override
&nbsp;	Object getJson() {
<b class="fc">&nbsp;		next_(Action.accept);</b>
<b class="fc">&nbsp;		return m_jsonString.toString();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void startObject() {
<b class="fc">&nbsp;		next_(Action.addObject);</b>
<b class="fc">&nbsp;		m_jsonString.append(&#39;{&#39;);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.objectStart);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void startArray() {
<b class="fc">&nbsp;		next_(Action.addArray);</b>
<b class="fc">&nbsp;		m_jsonString.append(&#39;[&#39;);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.arrayStart);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void endObject() {
<b class="fc">&nbsp;		next_(Action.popObject);</b>
<b class="fc">&nbsp;		m_jsonString.append(&#39;}&#39;);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void endArray() {
<b class="fc">&nbsp;		next_(Action.popArray);</b>
<b class="fc">&nbsp;		m_jsonString.append(&#39;]&#39;);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addFieldName(String fieldName) {
<b class="fc">&nbsp;		next_(Action.addKey);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairObject(String fieldName) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueObject_();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairArray(String fieldName) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueArray_();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairString(String fieldName, String v) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueString_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairDouble(String fieldName, double v) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueDouble_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairDouble(String fieldName, double v, int precision, boolean bFixedPoint) {
<b class="nc">&nbsp;		next_(Action.addPair);</b>
<b class="nc">&nbsp;		appendQuote_(fieldName);</b>
<b class="nc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="nc">&nbsp;		addValueDouble_(v, precision, bFixedPoint);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairInt(String fieldName, int v) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueInt_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairBoolean(String fieldName, boolean v) {
<b class="nc">&nbsp;		next_(Action.addPair);</b>
<b class="nc">&nbsp;		appendQuote_(fieldName);</b>
<b class="nc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="nc">&nbsp;		addValueBoolean_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addPairNull(String fieldName) {
<b class="fc">&nbsp;		next_(Action.addPair);</b>
<b class="fc">&nbsp;		appendQuote_(fieldName);</b>
<b class="fc">&nbsp;		m_jsonString.append(&quot;:&quot;);</b>
<b class="fc">&nbsp;		addValueNull_();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueObject() {
<b class="nc">&nbsp;		next_(Action.addObject);</b>
<b class="nc">&nbsp;		addValueObject_();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueArray() {
<b class="fc">&nbsp;		next_(Action.addArray);</b>
<b class="fc">&nbsp;		addValueArray_();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueString(String v) {
<b class="fc">&nbsp;		next_(Action.addTerminal);</b>
<b class="fc">&nbsp;		addValueString_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueDouble(double v) {
<b class="fc">&nbsp;		next_(Action.addTerminal);</b>
<b class="fc">&nbsp;		addValueDouble_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueDouble(double v, int precision, boolean bFixedPoint) {
<b class="fc">&nbsp;		next_(Action.addTerminal);</b>
<b class="fc">&nbsp;		addValueDouble_(v, precision, bFixedPoint);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueInt(int v) {
<b class="nc">&nbsp;		next_(Action.addTerminal);</b>
<b class="nc">&nbsp;		addValueInt_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueBoolean(boolean v) {
<b class="nc">&nbsp;		next_(Action.addTerminal);</b>
<b class="nc">&nbsp;		addValueBoolean_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	void addValueNull() {
<b class="fc">&nbsp;		next_(Action.addTerminal);</b>
<b class="fc">&nbsp;		addValueNull_();</b>
&nbsp;	}
&nbsp;
<b class="fc">&nbsp;	JsonStringWriter() {</b>
<b class="fc">&nbsp;		m_jsonString = new StringBuilder();</b>
<b class="fc">&nbsp;		m_functionStack = new AttributeStreamOfInt32(0);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.accept);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.start);</b>
&nbsp;	}
&nbsp;
&nbsp;	private StringBuilder m_jsonString;
&nbsp;	private AttributeStreamOfInt32 m_functionStack;
&nbsp;
&nbsp;	private void addValueObject_() {
<b class="fc">&nbsp;		m_jsonString.append(&#39;{&#39;);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.objectStart);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueArray_() {
<b class="fc">&nbsp;		m_jsonString.append(&#39;[&#39;);</b>
<b class="fc">&nbsp;		m_functionStack.add(State.arrayStart);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueString_(String v) {
<b class="fc">&nbsp;		appendQuote_(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueDouble_(double v) {
<b class="fc">&nbsp;		if (NumberUtils.isNaN(v)) {</b>
<b class="nc">&nbsp;			addValueNull_();</b>
&nbsp;			return;
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		StringUtils.appendDouble(v, 17, m_jsonString);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueDouble_(double v, int precision, boolean bFixedPoint) {
<b class="fc">&nbsp;		if (NumberUtils.isNaN(v)) {</b>
<b class="nc">&nbsp;			addValueNull_();</b>
&nbsp;			return;
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		if (bFixedPoint)</b>
<b class="nc">&nbsp;			StringUtils.appendDoubleF(v, precision, m_jsonString);</b>
&nbsp;		else
<b class="fc">&nbsp;			StringUtils.appendDouble(v, precision, m_jsonString);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueInt_(int v) {
<b class="fc">&nbsp;		m_jsonString.append(v);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void addValueBoolean_(boolean v) {
<b class="nc">&nbsp;		if (v) {</b>
<b class="nc">&nbsp;			m_jsonString.append(&quot;true&quot;);</b>
&nbsp;		} else {
<b class="nc">&nbsp;			m_jsonString.append(&quot;false&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void addValueNull_() {
<b class="fc">&nbsp;		m_jsonString.append(&quot;null&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void next_(int action) {
<b class="fc">&nbsp;		switch (m_functionStack.getLast()) {</b>
&nbsp;		case State.accept:
<b class="fc">&nbsp;			accept_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.start:
<b class="fc">&nbsp;			start_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.objectStart:
<b class="fc">&nbsp;			objectStart_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.arrayStart:
<b class="fc">&nbsp;			arrayStart_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.pairEnd:
<b class="fc">&nbsp;			pairEnd_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.elementEnd:
<b class="fc">&nbsp;			elementEnd_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		case State.fieldNameEnd:
<b class="fc">&nbsp;			fieldNameEnd_(action);</b>
<b class="fc">&nbsp;			break;</b>
&nbsp;		default:
<b class="nc">&nbsp;			throw new GeometryException(&quot;internal error&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void accept_(int action) {
<b class="fc">&nbsp;		if (action != Action.accept) {</b>
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void start_(int action) {
<b class="fc">&nbsp;		if ((action &amp; Action.addContainer) != 0) {</b>
<b class="fc">&nbsp;			m_functionStack.removeLast();</b>
&nbsp;		} else {
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void objectStart_(int action) {
<b class="fc">&nbsp;		if (action != Action.popObject &amp;&amp; action != Action.addPair &amp;&amp; action != Action.addKey)</b>
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;
<b class="fc">&nbsp;		m_functionStack.removeLast();</b>
&nbsp;
<b class="fc">&nbsp;		if (action == Action.addPair) {</b>
<b class="fc">&nbsp;			m_functionStack.add(State.pairEnd);</b>
<b class="fc">&nbsp;		} else if (action == Action.addKey) {</b>
<b class="fc">&nbsp;			m_functionStack.add(State.pairEnd);</b>
<b class="fc">&nbsp;			m_functionStack.add(State.fieldNameEnd);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void pairEnd_(int action) {
<b class="fc">&nbsp;		if (action == Action.addPair) {</b>
<b class="fc">&nbsp;			m_jsonString.append(&#39;,&#39;);</b>
<b class="fc">&nbsp;		} else if (action == Action.addKey) {</b>
<b class="fc">&nbsp;			m_jsonString.append(&#39;,&#39;);</b>
<b class="fc">&nbsp;			m_functionStack.add(State.fieldNameEnd);</b>
<b class="fc">&nbsp;		} else if (action == Action.popObject) {</b>
<b class="fc">&nbsp;			m_functionStack.removeLast();</b>
&nbsp;		} else {
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void arrayStart_(int action) {
<b class="fc">&nbsp;		if ((action &amp; Action.addValue) == 0 &amp;&amp; action != Action.popArray)</b>
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;
<b class="fc">&nbsp;		m_functionStack.removeLast();</b>
&nbsp;
<b class="fc">&nbsp;		if ((action &amp; Action.addValue) != 0) {</b>
<b class="fc">&nbsp;			m_functionStack.add(State.elementEnd);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void elementEnd_(int action) {
<b class="fc">&nbsp;		if ((action &amp; Action.addValue) != 0) {</b>
<b class="fc">&nbsp;			m_jsonString.append(&#39;,&#39;);</b>
<b class="fc">&nbsp;		} else if (action == Action.popArray) {</b>
<b class="fc">&nbsp;			m_functionStack.removeLast();</b>
&nbsp;		} else {
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void fieldNameEnd_(int action) {
<b class="fc">&nbsp;		if ((action &amp; Action.addValue) == 0)</b>
<b class="nc">&nbsp;			throw new GeometryException(&quot;invalid call&quot;);</b>
&nbsp;
<b class="fc">&nbsp;		m_functionStack.removeLast();</b>
<b class="fc">&nbsp;		m_jsonString.append(&#39;:&#39;);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void appendQuote_(String string) {
<b class="fc">&nbsp;		int count = 0;</b>
<b class="fc">&nbsp;		int start = 0;</b>
<b class="fc">&nbsp;		int end = string.length();</b>
&nbsp;
<b class="fc">&nbsp;		m_jsonString.append(&#39;&quot;&#39;);</b>
&nbsp;
<b class="fc">&nbsp;		for (int i = 0; i &lt; end; i++) {</b>
<b class="fc">&nbsp;			switch (string.charAt(i)) {</b>
&nbsp;			case &#39;&quot;&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\\&quot;&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;\\&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\\\&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;/&#39;:
<b class="fc">&nbsp;				if (i &gt; 0 &amp;&amp; string.charAt(i - 1) == &#39;&lt;&#39;) {</b>
<b class="fc">&nbsp;					if (count &gt; 0) {</b>
<b class="fc">&nbsp;						m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;						count = 0;</b>
&nbsp;					}
<b class="fc">&nbsp;					m_jsonString.append(&quot;\\/&quot;);</b>
<b class="fc">&nbsp;					start = i + 1;</b>
&nbsp;				} else {
<b class="fc">&nbsp;					count++;</b>
&nbsp;				}
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;\b&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\b&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;\f&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\f&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;\n&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\n&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			case &#39;\r&#39;:
<b class="nc">&nbsp;				if (count &gt; 0) {</b>
<b class="nc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="nc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="nc">&nbsp;				m_jsonString.append(&quot;\\r&quot;);</b>
<b class="nc">&nbsp;				start = i + 1;</b>
<b class="nc">&nbsp;				break;</b>
&nbsp;			case &#39;\t&#39;:
<b class="fc">&nbsp;				if (count &gt; 0) {</b>
<b class="fc">&nbsp;					m_jsonString.append(string, start, start + count);</b>
<b class="fc">&nbsp;					count = 0;</b>
&nbsp;				}
<b class="fc">&nbsp;				m_jsonString.append(&quot;\\t&quot;);</b>
<b class="fc">&nbsp;				start = i + 1;</b>
<b class="fc">&nbsp;				break;</b>
&nbsp;			default:
<b class="fc">&nbsp;				count++;</b>
&nbsp;				break;
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		if (count &gt; 0) {</b>
<b class="fc">&nbsp;			m_jsonString.append(string, start, start + count);</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		m_jsonString.append(&#39;&quot;&#39;);</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-21 16:04</div>
</div>
</body>
</html>
