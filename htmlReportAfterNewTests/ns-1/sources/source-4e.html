


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > OperatorCentroid2DLocal</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.esri.core.geometry</a>
</div>

<h1>Coverage Summary for Class: OperatorCentroid2DLocal (com.esri.core.geometry)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">OperatorCentroid2DLocal</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (6/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    97,2%
  </span>
  <span class="absValue">
    (70/72)
  </span>
</td>
</tr>
  <tr>
    <td class="name">OperatorCentroid2DLocal$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (7/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    97,3%
  </span>
  <span class="absValue">
    (71/73)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; Copyright 1995-2019 Esri
&nbsp;
&nbsp;   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp;   you may not use this file except in compliance with the License.
&nbsp;   You may obtain a copy of the License at
&nbsp;
&nbsp;       http://www.apache.org/licenses/LICENSE-2.0
&nbsp;
&nbsp;   Unless required by applicable law or agreed to in writing, software
&nbsp;   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp;   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp;   See the License for the specific language governing permissions and
&nbsp;   limitations under the License.
&nbsp;
&nbsp; For additional information, contact:
&nbsp; Environmental Systems Research Institute, Inc.
&nbsp; Attn: Contracts Dept
&nbsp; 380 New York Street
&nbsp; Redlands, California, USA 92373
&nbsp;
&nbsp; email: contracts@esri.com
&nbsp; */
&nbsp;package com.esri.core.geometry;
&nbsp;
<b class="fc">&nbsp;public class OperatorCentroid2DLocal extends OperatorCentroid2D {</b>
&nbsp;	@Override
&nbsp;	public Point2D execute(Geometry geometry, ProgressTracker progressTracker) {
<b class="fc">&nbsp;		if (geometry.isEmpty()) {</b>
<b class="fc">&nbsp;			return null;</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		Geometry.Type geometryType = geometry.getType();</b>
<b class="fc">&nbsp;		switch (geometryType) {</b>
&nbsp;		case Point:
<b class="fc">&nbsp;			return ((Point) geometry).getXY();</b>
&nbsp;		case Line:
<b class="fc">&nbsp;			return computeLineCentroid((Line) geometry);</b>
&nbsp;		case Envelope:
<b class="fc">&nbsp;			return ((Envelope) geometry).getCenterXY();</b>
&nbsp;		case MultiPoint:
<b class="fc">&nbsp;			return computePointsCentroid((MultiPoint) geometry);</b>
&nbsp;		case Polyline:
<b class="fc">&nbsp;			return computePolylineCentroid(((Polyline) geometry));</b>
&nbsp;		case Polygon:
<b class="fc">&nbsp;			return computePolygonCentroid((Polygon) geometry);</b>
&nbsp;		default:
<b class="nc">&nbsp;			throw new UnsupportedOperationException(&quot;Unexpected geometry type: &quot; + geometryType);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private static Point2D computeLineCentroid(Line line) {
<b class="fc">&nbsp;		return new Point2D((line.getEndX() - line.getStartX()) / 2, (line.getEndY() - line.getStartY()) / 2);</b>
&nbsp;	}
&nbsp;
&nbsp;	// Points centroid is arithmetic mean of the input points
&nbsp;	private static Point2D computePointsCentroid(MultiVertexGeometry multiPoint) {
<b class="fc">&nbsp;		double xSum = 0;</b>
<b class="fc">&nbsp;		double ySum = 0;</b>
<b class="fc">&nbsp;		int pointCount = multiPoint.getPointCount();</b>
<b class="fc">&nbsp;		Point2D point2D = new Point2D();</b>
<b class="fc">&nbsp;		for (int i = 0; i &lt; pointCount; i++) {</b>
<b class="fc">&nbsp;			multiPoint.getXY(i, point2D);</b>
<b class="fc">&nbsp;			xSum += point2D.x;</b>
<b class="fc">&nbsp;			ySum += point2D.y;</b>
&nbsp;		}
<b class="fc">&nbsp;		return new Point2D(xSum / pointCount, ySum / pointCount);</b>
&nbsp;	}
&nbsp;
&nbsp;	// Lines centroid is weighted mean of each line segment, weight in terms of line
&nbsp;	// length
&nbsp;	private static Point2D computePolylineCentroid(MultiPath polyline) {
<b class="fc">&nbsp;		double totalLength = polyline.calculateLength2D();</b>
<b class="fc">&nbsp;		if (totalLength == 0) {</b>
<b class="fc">&nbsp;			return computePointsCentroid(polyline);</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		MathUtils.KahanSummator xSum = new MathUtils.KahanSummator(0);</b>
<b class="fc">&nbsp;		MathUtils.KahanSummator ySum = new MathUtils.KahanSummator(0);</b>
<b class="fc">&nbsp;		Point2D point = new Point2D();</b>
<b class="fc">&nbsp;		SegmentIterator iter = polyline.querySegmentIterator();</b>
<b class="fc">&nbsp;		while (iter.nextPath()) {</b>
<b class="fc">&nbsp;			while (iter.hasNextSegment()) {</b>
<b class="fc">&nbsp;				Segment seg = iter.nextSegment();</b>
<b class="fc">&nbsp;				seg.getCoord2D(0.5, point);</b>
<b class="fc">&nbsp;				double length = seg.calculateLength2D();</b>
<b class="fc">&nbsp;				point.scale(length);</b>
<b class="fc">&nbsp;				xSum.add(point.x);</b>
<b class="fc">&nbsp;				ySum.add(point.y);</b>
<b class="fc">&nbsp;			}</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		return new Point2D(xSum.getResult() / totalLength, ySum.getResult() / totalLength);</b>
&nbsp;	}
&nbsp;
&nbsp;	// Polygon centroid: area weighted average of centroids
&nbsp;	private static Point2D computePolygonCentroid(Polygon polygon) {
<b class="fc">&nbsp;		double totalArea = polygon.calculateArea2D();</b>
<b class="fc">&nbsp;		if (totalArea == 0)</b>
&nbsp;		{
<b class="fc">&nbsp;			return computePolylineCentroid(polygon);</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		MathUtils.KahanSummator xSum = new MathUtils.KahanSummator(0);</b>
<b class="fc">&nbsp;		MathUtils.KahanSummator ySum = new MathUtils.KahanSummator(0);</b>
<b class="fc">&nbsp;		Point2D startPoint = new Point2D();</b>
<b class="fc">&nbsp;		Point2D current = new Point2D();</b>
<b class="fc">&nbsp;		Point2D next = new Point2D();</b>
<b class="fc">&nbsp;		Point2D origin = polygon.getXY(0);</b>
&nbsp;
<b class="fc">&nbsp;		for (int ipath = 0, npaths = polygon.getPathCount(); ipath &lt; npaths; ipath++) {</b>
<b class="fc">&nbsp;			int startIndex = polygon.getPathStart(ipath);</b>
<b class="fc">&nbsp;			int endIndex = polygon.getPathEnd(ipath);</b>
<b class="fc">&nbsp;			int pointCount = endIndex - startIndex;</b>
<b class="fc">&nbsp;			if (pointCount &lt; 3) {</b>
<b class="nc">&nbsp;				continue;</b>
&nbsp;			}
&nbsp;			
<b class="fc">&nbsp;			polygon.getXY(startIndex, startPoint);</b>
<b class="fc">&nbsp;			polygon.getXY(startIndex + 1, current);</b>
<b class="fc">&nbsp;			current.sub(startPoint);</b>
<b class="fc">&nbsp;			for (int i = startIndex + 2, n = endIndex; i &lt; n; i++) {</b>
<b class="fc">&nbsp;				polygon.getXY(i, next);</b>
<b class="fc">&nbsp;				next.sub(startPoint);</b>
<b class="fc">&nbsp;				double twiceTriangleArea = next.x * current.y - current.x * next.y;</b>
<b class="fc">&nbsp;				xSum.add((current.x + next.x) * twiceTriangleArea);</b>
<b class="fc">&nbsp;				ySum.add((current.y + next.y) * twiceTriangleArea);</b>
<b class="fc">&nbsp;				current.setCoords(next);</b>
&nbsp;			}
&nbsp;			
<b class="fc">&nbsp;			startPoint.sub(origin);</b>
<b class="fc">&nbsp;			startPoint.scale(6.0 * polygon.calculateRingArea2D(ipath));</b>
&nbsp;			//add weighted startPoint
<b class="fc">&nbsp;			xSum.add(startPoint.x);</b>
<b class="fc">&nbsp;			ySum.add(startPoint.y);</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		totalArea *= 6.0;</b>
<b class="fc">&nbsp;		Point2D res = new Point2D(xSum.getResult() / totalArea, ySum.getResult() / totalArea);</b>
<b class="fc">&nbsp;		res.add(origin);</b>
<b class="fc">&nbsp;		return res;</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-21 16:04</div>
</div>
</body>
</html>
